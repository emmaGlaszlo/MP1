---
title: "MP1"
author: "Emma Laslo, Jonah Kotzen, Marc Godec"
date: "2024-01-28"
output: html_document
---


```{r setup, include=FALSE}

# library set up

knitr::opts_chunk$set(echo = TRUE)
library(av)
library(tidyverse)
library(ggplot2)
```

```{r chunk 2, include=FALSE, eval=FALSE}

# DO NOT RUN!!!!!! (this is for movies to avi)

f <- list.files(full.names = T,pattern=".MOV")

#create a place to store images
dir.create("images")

#for each file, f, breakup the .MOV into the images and build avi files
for(i in f){
  if(dir.exists("images")) unlink("images",recursive = T)

  #extract images
  av_video_images(i,destdir ="images",format="tiff")
  
  #list images
  f.i <- list.files("images",full.names = T)
  
  #make the avi from the images from the MOV
  av_encode_video(f.i,gsub("MOV","avi",basename(i)),codec = "rawvideo")
}
```


# Reading in Data

```{r chunk 3, include=TRUE}
walk.files <- list.files(pattern="walk_")
print(walk.files)

walk.dat <- list() #make a list for storing
for(i in walk.files){
  walk.i <- read_delim(i,delim="\t") #read data as a tibble
  met.dat <- unlist(strsplit(i,"_")) #split i for metadata and unlist it
  speed <- met.dat[2] #get speed
  subject <- gsub(".txt","",met.dat[3]) #remove ".txt" 
  walk.dat[[i]] <- walk.i%>%
    mutate(speed=speed,subject=subject)
}

walk.dat <- do.call(rbind,walk.dat)
head(walk.dat)

colnames(walk.dat) <- str_remove(colnames(walk.dat)," \\[pixel\\]| \\[sec\\]")
head(walk.dat)

unique(walk.dat$subject)
```

# Graphing Data 

## graph (not flipped)
```{r chunk 3.25, include=TRUE}
walk.dat2 <- walk.dat%>%
  select(TID,PID,x,y,subject,speed)
walk.dat2%>%
  ggplot(aes(x,y,col=speed))+geom_point()+facet_grid(subject~.)

```

## graph (flipped)
```{r chunk 3.5, include=TRUE}
walk.dat2 <- walk.dat2%>%
  group_by(speed,subject)%>%
  mutate(y=abs(y-max(y)))
walk.dat2%>%
  ggplot(aes(x,y,col=speed))+geom_point()+facet_grid(subject~.)#grid it with columns = to speed

```
# Manipulating Data

## Correlating TIDs to Regions
```{r chunk 4, include=TRUE}
walk.dat2 <- walk.dat2%>%
  mutate(TID=replace(TID, TID==1, "hipR"))%>%
  mutate(TID=replace(TID, TID==2, "hipC"))%>%
  mutate(TID=replace(TID, TID==3, "legR"))
head(walk.dat2)
```

## Pivoting Wider
```{r chunk 5, include=TRUE}
walk.wide <- walk.dat2%>%
  pivot_wider(names_from=TID,values_from=c("x","y"))
head(walk.wide)
```

## Calculating Pelvic Tilt (Theta)
```{r chunk final, include=TRUE}
# Assuming walk.wide is our data frame after using pivot_wider()
walk.wide <- walk.dat2 %>%
  pivot_wider(names_from = TID, values_from = c("x", "y"))
# Calculating the angle theta
walk.wide <- walk.wide %>%
  mutate(
    dx = x_hipR - x_hipC,  # Change in x-coordinate
    dy = y_hipR - y_hipC,  # Change in y-coordinate
    theta = atan2(dy, dx) * (180 / pi)  # Calculate the angle in degrees
  )
# Viewing the first few rows of the data with theta
head(walk.wide)
```

## Calculating Mean Max Tilt
```{r chunk final final, include=TRUE}
# Calculate the maximum pelvic tilt angle for each subject and each speed
max_tilt_per_subject_speed <- walk.wide %>%
  group_by(subject, speed) %>%
  summarize(max_tilt = max(theta, na.rm = TRUE))

# Calculate the mean of the maximum tilt angles for each subject and each speed
mean_max_tilt_per_subject <- max_tilt_per_subject_speed %>%
  group_by(subject, speed) %>%
  summarize(mean_max_tilt = mean(max_tilt, na.rm = TRUE))

# Viewing the result
print(mean_max_tilt_per_subject)

```

## Graphing Max Tilt Between Speeds
```{r chunk tlt}

ggplot(mean_max_tilt_per_subject, aes(x = subject, y = mean_max_tilt, fill = speed)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  labs(title = "Mean Maximum Pelvic Tilt Angle by Subject and Speed",
       x = "Subject",
       y = "Mean Maximum Pelvic Tilt Angle (degrees)",
       fill = "Speed") +
  theme_minimal()

```


# Areas to Address

## Comparison of Theoretical and Actual Walking Speeds:
- Analyze how the class-wide vmax (theoretical maximum walking speed calculated using the inverted pendulum model) compares to the actual observed walking speeds from your experiments.
- Discuss any trends or discrepancies you notice. Are the theoretical speeds higher or lower than the actual speeds? What might explain these differences?
- Consider factors like the simplifications in the theoretical model (rigid leg, ignoring air resistance, etc.) and how they might impact the results.

**Data Needed**:  Compare the class-wide theoretical maximum walking speed (v max) with the actual observed speeds.
**Code Implementation**: If not already done, calculate vmax using the inverted pendulum model and compare it with the observed speeds. This might involve additional calculations outside of what is currently in your script.

## Patterns Revealed by Calculating the Froude Number:
- Calculate the Froude number for your walking trials. The Froude number is a dimensionless number defined as Fr = v^2/gL, where v is the walking speed, g is the acceleration due to gravity, and L is the leg length.
- Analyze if there's a relationship between the Froude number and walking patterns. For example, is there a threshold Froude number beyond which the walking pattern changes significantly?

**Data Needed**: Calculate the Froude number for each walking trial.
**Code Implementation**: Add a segment in your script to calculate and analyze the Froude numbers. This involves applying the formula Fr = v^2/gL to your data.

## Variation of Actual Pendulum Walking Speed with Human Size and Sex
- Examine how walking speed varies with the size (height, leg length) and sex of the participants. Are there noticeable differences?
- Discuss these findings in the context of biomechanics. Does a larger size correspond to faster or slower walking speeds? How does sex impact walking speed?

**Data Needed**: Relationship between walking speed, human size (height, leg length), and sex.
**Code Implementation**: You might need to incorporate additional data (e.g., height, leg length) into your dataset and perform analyses to see how these factors correlate with walking speed.

## Changes in Pelvic Tilt with Increased Walking Speeds
- Using your data on pelvic tilt angles at different speeds, analyze how pelvic tilt changes as walking speed increases.
- Discuss the biomechanical basis for these changes. Why does the body need to increase pelvic tilt at higher speeds? Consider the role of stride length, balance, and efficiency.

**Data Needed**: How pelvic tilt changes with walking speed.
**Code Implementation** Use your current data on pelvic tilt angles across different speeds. Perform statistical analysis or visualization to show how pelvic tilt changes with speed.

## Variation of Pelvic Tilt at Normal Walking Speeds with Human Size and Sex:

- Analyze if there's a variation in pelvic tilt at comfortable walking speeds based on the size and sex of the participants.
- Discuss how and why these factors might influence pelvic tilt. Does a larger body size or different sex correlate with more or less pelvic tilt? What might be the biomechanical reasons for this?

**Data Needed**: Relationship between pelvic tilt at comfortable speeds, body size, and sex.
**Code Implementation**: Similar to walking speed, you may need additional data on body size. Analyze how these factors influence pelvic tilt at normal speeds.
